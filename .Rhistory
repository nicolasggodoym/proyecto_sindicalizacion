~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion)) %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(ano,actividad_raw) %>%
mutate(lag_duracion = dplyr::lag(duracion))
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion))
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion)) %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
group_by(actividad_raw, ano) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion)) %>%
ungroup() %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a %>%
select(ano, actividad_raw, duracion) %>%
na.omit %>%
write_xlsx("output/data/duracion_huelgas.xlsx")
directorio = "C:/Users/nicol/Downloads"
setwd(directorio)
archivos = list.files()
?list.files
archivos = list.files(pattern = "2023-10-13_XV. Arica y Parinacota_*.rds")
archivos = list.files(pattern = "2023-10-13_XV. Arica y Parinacota")
archivos
a = map(archivos, ~readRDS(.x))
library(tidyverse)
a = map(archivos, ~readRDS(.x))
a[[1]]
a[[2]]
a[[3]]
a[[4]]
a[[5]]
library(ggplotly)
library(plotly)
install.packages("plotly")
library(plotly)
a[[3]]
a[[4]]
a[[5]]
a[[6]]
a[[7]]
a[[5]]
print(a[[5]])
a[[10]]
a[[9]]
a[[8]]
a[[7]]
View(a)
a[[5]]
a[[4]]
a[[5]]
library(ggplot2)
library(plotly)
a[[5]]
print(readRDS(archivos[[5]]))
print(readRDS(archivos[[6]]))
print(readRDS(archivos[[5]]))
class(readRDS(archivos[[5]]))
View(a)
print(a[[5]])
archivos[[5]])
archivos[[5]]
archivos[[6]]
archivos[[7]]
archivos[[8]]
print(readRDS(archivos[[5]])) #Autoaplicado
print(readRDS(archivos[[6]])) #Emp
print(readRDS(archivos[[7]])) #ST
print(readRDS(archivos[[6]])) #Emp
print(readRDS(archivos[[7]])) #ST
ohl <- read.csv2("input/data/OHL1979_2020.csv", na.strings = "")
# Selección y filtrado ----------------------------------------------------
ohl_p <- ohl %>%
filter(yr %in% c(1998:2019) & inst %in% c(1,2)) %>%
select(sector2 = ciuur2,
sector3 = ciuur3,
sector4 = ciuur4,
ano = yr,
duracion,
ddpp,
rangoemp,
#org,
tc,
#reg1,
leg,
dptp = dhtp) %>%
# Recodificación ----------------------------------------------------------
mutate(actividad_raw = case_when(sector2 == 1 | sector3 %in% c(1,2) | sector4 == 0 ~ "1. Agricultura, ganadería, silvicultura y pesca",
sector2 == 2 | sector3 == 3 | sector4 == 1 ~ "2. Minería",
sector2 == 3 | sector3 == 4 | sector4 == 2 ~ "3. Industrias manufactureras",
sector2 == 4 | sector3 == 5 | sector4 %in% c(3,4) ~ "4. Suministro de electricidad, gas y agua",
sector2 == 5 | sector3 == 6 | sector4 == 5 ~ "5. Construcción",
sector2 == 6 | sector3 %in% c(7,8) | sector4 %in% c(6,8) ~ "6. Comercio, hoteles y restaurantes",
sector2 == 7 | sector3 == 9 | sector4 %in% c(7,9) ~ "7. Transporte y comunicaciones",
sector2 == 8 | sector3 %in% c(10,11) | sector4 %in% c(10:13) ~ "8. Servicios financieros, inmobiliarios y empresariales",
sector2 %in% c(9:12) | sector3 %in% c(12:17) | sector4 %in% c(14:20) ~ "9. Servicios sociales, domésticos, profesionales y otros",
TRUE ~ NA_character_) %>%
factor(),
dptp = as.numeric(gsub(",", ".", .$dptp)),
leg = ifelse(leg == 1, 1, 0),
extra_leg = ifelse(leg == 0, 1, 0)) %>%
rowwise() %>%
mutate(
n_huelga = sum(leg, extra_leg, na.rm = T)
) %>%
ungroup() %>%
select(ano,
actividad_raw,
duracion,
ddpp,
rangoemp,
tc,
n_huelga,
leg,
extra_leg,
dptp)
pacman::p_load(tidyverse, readxl,sjmisc)
ohl <- read.csv2("input/data/OHL1979_2020.csv", na.strings = "")
# Selección y filtrado ----------------------------------------------------
ohl_p <- ohl %>%
filter(yr %in% c(1998:2019) & inst %in% c(1,2)) %>%
select(sector2 = ciuur2,
sector3 = ciuur3,
sector4 = ciuur4,
ano = yr,
duracion,
ddpp,
rangoemp,
#org,
tc,
#reg1,
leg,
dptp = dhtp) %>%
# Recodificación ----------------------------------------------------------
mutate(actividad_raw = case_when(sector2 == 1 | sector3 %in% c(1,2) | sector4 == 0 ~ "1. Agricultura, ganadería, silvicultura y pesca",
sector2 == 2 | sector3 == 3 | sector4 == 1 ~ "2. Minería",
sector2 == 3 | sector3 == 4 | sector4 == 2 ~ "3. Industrias manufactureras",
sector2 == 4 | sector3 == 5 | sector4 %in% c(3,4) ~ "4. Suministro de electricidad, gas y agua",
sector2 == 5 | sector3 == 6 | sector4 == 5 ~ "5. Construcción",
sector2 == 6 | sector3 %in% c(7,8) | sector4 %in% c(6,8) ~ "6. Comercio, hoteles y restaurantes",
sector2 == 7 | sector3 == 9 | sector4 %in% c(7,9) ~ "7. Transporte y comunicaciones",
sector2 == 8 | sector3 %in% c(10,11) | sector4 %in% c(10:13) ~ "8. Servicios financieros, inmobiliarios y empresariales",
sector2 %in% c(9:12) | sector3 %in% c(12:17) | sector4 %in% c(14:20) ~ "9. Servicios sociales, domésticos, profesionales y otros",
TRUE ~ NA_character_) %>%
factor(),
dptp = as.numeric(gsub(",", ".", .$dptp)),
leg = ifelse(leg == 1, 1, 0),
extra_leg = ifelse(leg == 0, 1, 0)) %>%
rowwise() %>%
mutate(
n_huelga = sum(leg, extra_leg, na.rm = T)
) %>%
ungroup() %>%
select(ano,
actividad_raw,
duracion,
ddpp,
rangoemp,
tc,
n_huelga,
leg,
extra_leg,
dptp)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a %>% filter(str_detect(actividad_raw, "4."))
a %>% filter(str_detect(actividad_raw, "1."))
a %>% filter(str_detect(actividad_raw, "1."))
head(a %>% filter(str_detect(actividad_raw, "1.")), 21)
b=a %>% filter(str_detect(actividad_raw, "1."))
View(b)
b=a %>% filter(str_detect(actividad_raw, "4."))
b=a %>% filter(str_detect(actividad_raw, "5."))
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse,
haven,
writexl,
sjmisc)
# Cargar datos ------------------------------------------------------------
data = read_dta("input/data/CAE_RUT_FINAL.dta")
names(data)
frq(data$codigoactividad)
frq(data$descactividadeconomica)
frq(data$cae_2)
frq(data$id_cae2)
names(data)
frq(data$_merge)
frq(data$`_merge`)
frq(data$orden)
View(data)
max(data$orden)
# Revisar -----------------------------------------------------------------
proc = data %>%
data.table()
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse,
haven,
writexl,
sjmisc,
data.table)
# Revisar -----------------------------------------------------------------
proc = data %>%
data.table()
names(data)
# Revisar -----------------------------------------------------------------
proc = data %>%
mutate(across(c(orden, cae_2, id_cae2), ~.haven::as_factor(.))) %>%
data.table() %>%
.[,c("orden", "cae_2", "id_cae2")]
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse,
haven,
writexl,
sjmisc,
data.table)
# Revisar -----------------------------------------------------------------
proc = data %>%
mutate(across(c(orden, cae_2, id_cae2), ~haven::as_factor(.))) %>%
data.table() %>%
.[,c("orden", "cae_2", "id_cae2")]
sum(is.na(data$cae_2))
# Revisar -----------------------------------------------------------------
proc = data %>%
mutate(across(c(orden, cae_2, id_cae2), ~haven::as_factor(.)))
proc = proc %>%
data.table() %>%
.[,c("orden", "cae_2", "id_cae2")
]
rm(list=ls())
# Revisión CAE empresas DT ------------------------------------------------
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse,
haven,
writexl,
sjmisc,
data.table)
# Cargar datos ------------------------------------------------------------
data = read_dta("input/data/CAE_RUT_FINAL.dta")
# Revisar -----------------------------------------------------------------
proc = data %>%
mutate(across(c(orden, cae_2, id_cae2), ~haven::as_factor(.))) %>%
data.table
cae_2 = proc[,c("orden", "cae_2", "id_cae2")
][,.N, by = cae_2]
View(cae_2)
id_cae2 = proc[,c("orden", "cae_2", "id_cae2")
][,.N, by = id_cae2]
View(id_cae2)
cae_2 = proc[,c("orden", "cae_2", "id_cae2")
][,.N, keyby = cae_2]
id_cae2 = proc[,c("orden", "cae_2", "id_cae2")
][,.N, keyby = id_cae2]
View(id_cae2)
View(cae_2)
frq(cae_2$cae_2)
levels(cae_2$cae_2)
View(cae_2)
cae_2 = proc[,c("orden", "cae_2", "id_cae2")
][,.N, keyby = cae_2] %>%
mutate(id_cae2 = n()) %>%
select(id_cae2, cae_2, N)
View(cae_2)
cae_2 = proc[,c("orden", "cae_2", "id_cae2")
][,.N, keyby = cae_2] %>%
mutate(id_cae2 = 1:n()) %>%
select(id_cae2, cae_2, N)
View(cae_2)
write_xlsx("output/data/CAE_DT.xlsx")
write_xlsx(cae_2, "output/data/CAE_DT.xlsx")
70*15
75*15
rm(list=ls())
# Procesamiento datos ENE 2006  -------------------------------------------
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse,
sjmisc,
haven)
# Cargar datos ------------------------------------------------------------
files = list.files("input/data/ene", pattern = "-11.RData") %>%
str_remove("-11.RData")
data.list = imap(files, ~get(load(paste0("input/data/ene/", .x, "-11.RData"))))
data.list = setNames(data.list, files %>% str_remove("ene-"))
View(data.list)
View(data.list)
a = map(data.list, ~length(ncol(.x)))
View(a)
a = map(data.list, ~ncol(.x))
View(a)
b = data.frame(ano = names(a), ncol = map_dbl(a, ~.x[[1]]))
View(b)
b=arrange(b, ncol)
data.list[["2019"]] = data.list[["2019"]] %>%
rename(b1_ciuo88 = b1)
find_var(a$`2009`, "p07")
find_var(a$[[2009]], "p07")
find_var(a[[2009]], "p07")
find_var(data.list[[2009]], "p07")
find_var(data.list$`2009`, "p07")
frq(data.list$`2009`$p03)
frq(data.list$`2009`$p04)
frq(data.list$`2009`$p05)
frq(data.list$`2009`$p6)
frq(data.list$`2009`$p06)
frq(data.list$`2009`$p07)
frq(data.list$`2009`$p08)
frq(data.list$`2009`$p09)
frq(data.list$`2009`$p10)
frq(data.list$`2009`$p11)
frq(data.list$`2009`$p12)
frq(data.list$`2009`$p13)
frq(data.list$`2009`$p14)
frq(data.list$`2009`$p15)
frq(data.list$`2009`$p16)
frq(data.list$`2009`$p17)
frq(data.list$`2009`$p22)
frq(data.list$`2016`$cae_especifico)
find_var(data.list$`2016`, "econo")
find_var(data.list$`2016`, "activid")
names(data.list$`2016`)
frq(data.list$`2016`)
frq(data.list$`2016`$b13_caenes_2d)
frq(data.list$`2019`$b13_caenes_2d)
rm(list=ls())
pacman::p_load(tidyverse,
pdftools)
download.file("https://www.ine.gob.cl/docs/default-source/ocupacion-y-desocupacion/metodologia/espanol/documento-clasificador-de-rama-de-actividad-económica-caenes-(abril-2016).pdf?sfvrsn=1b1cc016_3?len=en",
"input/docs/CAENES_INE.pdf", mode = "wb")
download.file("https://www.ine.gob.cl/docs/default-source/ocupacion-y-desocupacion/metodologia/espanol/documento-clasificador-de-rama-de-actividad-económica-caenes-(abril-2016).pdf?sfvrsn=1b1cc016_3?len=en",
"input/docs/CAENES_INE.pdf")
txt = pdf_text("input/docs/CAENES_INE.pdf")
txt = pdf_text("input/docs/CAENES_INE.pdf")[[2:18]]
primera = txt[[1]]
text_matrix = primera %>% str_split("\\n", simplify = T)
text_m atrix
text_matrix
primera = txt[[11]]
text_matrix = primera %>% str_split("\\n", simplify = T)
text_matrix
text_matrix
text_matrix
text_matrix %>% str_which("Sección")
text_matrix[59]
text_matrix[58]
text_matrix[57]
text_matrix[56]
length(text_matrix)
length(text_matrix)-3
table_raw = text_matrix[1,
(text_matrix %>% str_which("Sección")+1):(length(text_matrix)-3-1)]
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("Sección", "División", "Clase", "Denominación")) %>%
as.tibble()
View(table)
table[1,]
table$Sección[1,]
table[1,]$Sección
table_raw = text_matrix[1,
(text_matrix %>% str_which("Sección")):(length(text_matrix)-3-1)]
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("Sección", "División", "Clase", "Denominación")) %>%
as.tibble()
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\w{,3}"))
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\w{3,}"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\W{3,}"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\[:alpha:]{3,}"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\b{3,}"))
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\[[:alpha:]]{3,}"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\b[a-zA-Z]{3,}\\b"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\b[a-zA-Z]{3,}\\b"),
clase = str_extract_all(seccion, pattern = "\\d{4}"),
division = str_extract_all(seccion, pattern = "\\d{2}"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract(seccion, pattern = "\\b[a-zA-Z]{3,}\\b"),
clase = str_extract(seccion, pattern = "\\d{4}"),
division = str_extract(seccion, pattern = "\\d{2}"),
seccion = str_extract(seccion, pattern = "\\b[A-Z]{1}\\b"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\b[a-zA-Z]{3,}\\b"),
clase = str_extract(seccion, pattern = "\\d{4}"),
division = str_extract(seccion, pattern = "\\d{2}"),
seccion = str_extract(seccion, pattern = "\\b[A-Z]{1}\\b"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\b[a-zA-Z]{2,}\\b"),
clase = str_extract(seccion, pattern = "\\d{4}"),
division = str_extract(seccion, pattern = "\\d{2}"),
seccion = str_extract(seccion, pattern = "\\b[A-Z]{1}\\b"))
View(table)
table = table_raw %>%
textConnection() %>%
read.csv(sep = "|",
col.names = c("seccion", "division", "clase", "denominacion")) %>%
as.tibble() %>%
mutate(denominacion = str_extract_all(seccion, pattern = "\\b[a-zA-Z]+\\b"),
clase = str_extract(seccion, pattern = "\\d{4}"),
division = str_extract(seccion, pattern = "\\d{2}"),
seccion = str_extract(seccion, pattern = "\\b[A-Z]{1}\\b"))
View(table)
