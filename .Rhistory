View(data)
rm(list=ls())
# Rev datos DT - total ----------------------------------------------------
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse, sjmisc, readxl, data.table)
# Cargar data -------------------------------------------------------------
# llave = read_xlsx("input/data/dt/CAE_DT_armonizado.xlsx") %>%
#   select(ID, ID2) %>%
#   unique
# NC y Huelgas ------------------------------------------------------------
files = list.files("input/data/dt", pattern = ".rds")[3:5]
nc_h = map(files, ~readRDS(paste0("input/data/dt/", .x)) %>%
merge(., read_xlsx("input/data/dt/CAE_DT_armonizado.xlsx") %>%
select(ID2, CAENES_1d) %>% unique, by = "ID2", all.x = T)
)
names(nc_h) = str_remove(files, pattern = ".rds$")
list2env(nc_h, globalenv())
rm(nc_h)
# OOSS --------------------------------------------------------------------
ooss = readRDS("input/data/dt/ooss.rds") #%>% merge(., llave,
#by = "ID", all.x = T)
# Estimaciones ------------------------------------------------------------
# Número de trabajadores --------------------------------------------------
h_nt = huelgas_ntrab_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, fecha, trab_mas_h, trab_fem_h,
trab_tot_h, tipo_org_h, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
summarise(n_huelgas = n(),
n_trab_huelga_tot = sum(trab_tot_h, na.rm = T),
n_trab_huelga_fem = sum(trab_fem_h, na.rm = T),
n_trab_huelga_mas = sum(trab_mas_h, na.rm = T),
mean_trab_huelga_tot = mean(trab_tot_h, na.rm = T),
mean_trab_huelga_fem = mean(trab_fem_h, na.rm = T),
mean_trab_huelga_mas = mean(trab_mas_h, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
h_dur = huelgas_dur_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, fecha, dias_h, resultado_neg_h, trab_mas_h,
trab_fem_h, trab_tot_h, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
summarise(huelgas_dur = mean(dias_h, na.rm = T),
n_dptp = sum(trab_tot_h*dias_h),
mean_dptp = mean(trab_tot_h*dias_h)) %>%
filter(!is.na(CAENES_1d))
nc = neg_col_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, trab_empresa_nc, tipo_inst, tipo_neg,
trab_mas_nc, trab_fem_nc, trab_tot_nc, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
#filter(trab_tot_nc < quantile(trab_tot_nc, .99, na.rm=T)) %>%
summarise(cubiertos_tot = sum(trab_tot_nc, na.rm = T),
cubiertos_fem = sum(trab_fem_nc, na.rm = T),
cubiertos_mas = sum(trab_mas_nc, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
nc_contrato = neg_col_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, trab_empresa_nc, tipo_inst, tipo_neg,
trab_mas_nc, trab_fem_nc, trab_tot_nc, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1 & tipo_inst == "Contrato Colectivo") %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
#filter(trab_tot_nc < quantile(trab_tot_nc, .99, na.rm=T)) %>%
summarise(cubiertos_cont = sum(trab_tot_nc, na.rm = T),
cubiertos_cont_fem = sum(trab_fem_nc, na.rm = T),
cubiertos_cont_mas = sum(trab_mas_nc, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
nc_otro = neg_col_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, trab_empresa_nc, tipo_inst, tipo_neg,
trab_mas_nc, trab_fem_nc, trab_tot_nc, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1 & tipo_inst != "Contrato Colectivo") %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
#filter(trab_tot_nc < quantile(trab_tot_nc, .975, na.rm=T)) %>%
summarise(cubiertos_otro = sum(trab_tot_nc, na.rm = T),
cubiertos_otro_fem = sum(trab_fem_nc, na.rm = T),
cubiertos_otro_mas = sum(trab_mas_nc, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
sind = ooss %>%
select(-c(cae_1d)) %>%
group_by(rsu, ano, rut_empresa) %>%
mutate(n = 1:n()) %>%
filter(n==1 & !tipo_org %in% c("Asociacion de funcionarios", "ASOCIACION DE FUNCIONARIOS")) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
#filter(afil_tot < quantile(afil_tot, .975, na.rm=T)) %>%
summarise(n_sind = n(),
n_afil_tot = sum(afil_tot, na.rm = T),
n_afil_mas = sum(afil_mas, na.rm = T),
n_afil_fem = sum(afil_fem, na.rm = T),
mean_afil_tot = mean(afil_tot, na.rm = T),
mean_afil_mas = mean(afil_mas, na.rm = T),
mean_afil_fem = mean(afil_fem, na.rm = T),
por_dir_fem = round(sum(n_dir_mas<n_dir_tot, na.rm = T)/n()*100,3),
por_fed = round(sum(!is.na(rsu_fed))/n()*100, 3),
por_conf = round(sum(!is.na(rsu_conf))/n()*100, 3),
por_cen = round(sum(!is.na(rsu_cen))/n()*100, 3)) %>%
ungroup() %>%
mutate(CAENES_1d = factor(CAENES_1d)) %>%
filter(!is.na(CAENES_1d))
data = list(nc, nc_contrato, nc_otro, h_nt, h_dur, sind) %>%
reduce(full_join, by = c("CAENES_1d", "ano"))
saveRDS(data, "output/data/data_dt_proc_final.rds")
rm(list=ls())
# Unificar data ENE - DT (OOSS-NC-H) --------------------------------------
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse, sjmisc, writexl)
# Cargar data -------------------------------------------------------------
dt = readRDS("output/data/data_dt_proc_final.rds")
ene = readRDS("output/data/ene_final_CAENES_1d.rds") %>%
mutate(CAENES_1d = factor(CAENES_1d),
ano = as.numeric(ano)) %>%
filter(!is.na(CAENES_1d) & CAENES_1d != "Total")
olas = data.frame(CAENES_1d = factor(rep(levels(ene$CAENES_1d)[1:14], 14)),
ano = map(2010:2023, ~rep(.x, 14)) %>% unlist())
# Unificar ----------------------------------------------------------------
data = list(ene, dt) %>%
reduce(full_join, by = c("CAENES_1d", "ano")) %>%
merge(olas,
.,
by = c("ano", "CAENES_1d"), all = T) %>%
arrange(ano, CAENES_1d) %>%
filter(ano %in% 2010:2023 & CAENES_1d != "34") %>%
mutate(across(total:por_cen,
~tidyr::replace_na(., 0)),
tasa_afiliacion = ifelse(if_all(c(n_afil_tot, total), ~.!=0), round((n_afil_tot/total)*100,3), 0),
por_cobertura = ifelse(if_all(c(cubiertos_tot, total), ~.!=0), round((cubiertos_tot/total)*100,3), 0),
por_cobertura_cont = ifelse(if_all(c(cubiertos_cont, total), ~.!=0), round((cubiertos_cont/total)*100,3), 0),
por_cobertura_otro = ifelse(if_all(c(cubiertos_otro, total), ~.!=0), round((cubiertos_otro/total)*100,3), 0),
n_sind_mil = ifelse(if_all(c(n_sind, total), ~.!=0), round((n_sind/(total/1000))*100,3), 0)) %>%
arrange(CAENES_1d, ano) %>%
#group_by(CAENES_1d, ano) %>%
mutate(across(c(tasa_afiliacion, por_cobertura, por_cobertura_cont, por_cobertura_otro),
~ifelse(ano %in% 2011:2023, dplyr::lag(.), 0),
.names = "lag_{.col}")) %>%
ungroup()
# Exportar ----------------------------------------------------------------
saveRDS(data,"output/data/data_dt_ene_final.rds")
# Explorar bugs -----------------------------------------------------------
#% mayores a 100
data %>%
summarise(across(c(tasa_afiliacion, por_cobertura, por_cobertura_cont),
~sum(. > 100)))
data %>%
filter(if_any(c(tasa_afiliacion, por_cobertura, por_cobertura_cont),
~.>100)) %>%
select(CAENES_1d, ano,
total, n_afil_tot, tasa_afiliacion,
cubiertos_tot, por_cobertura,
cubiertos_cont, por_cobertura_cont,
n_sind) %>%
write_xlsx("rev_porcentajes.xlsx")
ids=data %>%
filter(if_any(c(tasa_afiliacion, por_cobertura, por_cobertura_cont),
~.>100)) %>%
select(CAENES_1d) %>% unique() %>% pull()
j=data %>%
filter(CAENES_1d %in% ids) %>%
select(CAENES_1d, ano,
total, n_afil_tot, tasa_afiliacion,
cubiertos_tot, por_cobertura,
cubiertos_cont, por_cobertura_cont,
n_sind)
View(data)
View(j)
rm(list=ls())
# Rev datos DT - total ----------------------------------------------------
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse, sjmisc, readxl, data.table)
# Cargar data -------------------------------------------------------------
# llave = read_xlsx("input/data/dt/CAE_DT_armonizado.xlsx") %>%
#   select(ID, ID2) %>%
#   unique
# NC y Huelgas ------------------------------------------------------------
files = list.files("input/data/dt", pattern = ".rds")[3:5]
nc_h = map(files, ~readRDS(paste0("input/data/dt/", .x)) %>%
merge(., read_xlsx("input/data/dt/CAE_DT_armonizado.xlsx") %>%
select(ID2, CAENES_1d) %>% unique, by = "ID2", all.x = T)
)
names(nc_h) = str_remove(files, pattern = ".rds$")
list2env(nc_h, globalenv())
rm(nc_h)
# OOSS --------------------------------------------------------------------
ooss = readRDS("input/data/dt/ooss.rds") #%>% merge(., llave,
#by = "ID", all.x = T)
# Estimaciones ------------------------------------------------------------
# Número de trabajadores --------------------------------------------------
h_nt = huelgas_ntrab_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, fecha, trab_mas_h, trab_fem_h,
trab_tot_h, tipo_org_h, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
summarise(n_huelgas = n(),
n_trab_huelga_tot = sum(trab_tot_h, na.rm = T),
n_trab_huelga_fem = sum(trab_fem_h, na.rm = T),
n_trab_huelga_mas = sum(trab_mas_h, na.rm = T),
mean_trab_huelga_tot = mean(trab_tot_h, na.rm = T),
mean_trab_huelga_fem = mean(trab_fem_h, na.rm = T),
mean_trab_huelga_mas = mean(trab_mas_h, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
h_dur = huelgas_dur_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, fecha, dias_h, resultado_neg_h, trab_mas_h,
trab_fem_h, trab_tot_h, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
summarise(huelgas_dur = mean(dias_h, na.rm = T),
n_dptp = sum(trab_tot_h*dias_h),
mean_dptp = mean(trab_tot_h*dias_h)) %>%
filter(!is.na(CAENES_1d))
nc = neg_col_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, trab_empresa_nc, tipo_inst, tipo_neg,
trab_mas_nc, trab_fem_nc, trab_tot_nc, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
filter(trab_tot_nc < quantile(trab_tot_nc, .99, na.rm=T)) %>%
summarise(cubiertos_tot = sum(trab_tot_nc, na.rm = T),
cubiertos_fem = sum(trab_fem_nc, na.rm = T),
cubiertos_mas = sum(trab_mas_nc, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
nc_contrato = neg_col_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, trab_empresa_nc, tipo_inst, tipo_neg,
trab_mas_nc, trab_fem_nc, trab_tot_nc, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1 & tipo_inst == "Contrato Colectivo") %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
filter(trab_tot_nc < quantile(trab_tot_nc, .99, na.rm=T)) %>%
summarise(cubiertos_cont = sum(trab_tot_nc, na.rm = T),
cubiertos_cont_fem = sum(trab_fem_nc, na.rm = T),
cubiertos_cont_mas = sum(trab_mas_nc, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
nc_otro = neg_col_dt %>%
group_by(rut_empresa, rsu, codigoactividad, ano, trab_empresa_nc, tipo_inst, tipo_neg,
trab_mas_nc, trab_fem_nc, trab_tot_nc, codigoactividad_sii, ID2) %>%
mutate(n = 1:n()) %>%
filter(n==1 & tipo_inst != "Contrato Colectivo") %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
filter(trab_tot_nc < quantile(trab_tot_nc, .99, na.rm=T)) %>%
summarise(cubiertos_otro = sum(trab_tot_nc, na.rm = T),
cubiertos_otro_fem = sum(trab_fem_nc, na.rm = T),
cubiertos_otro_mas = sum(trab_mas_nc, na.rm = T)) %>%
filter(!is.na(CAENES_1d))
sind = ooss %>%
select(-c(cae_1d)) %>%
group_by(rsu, ano, rut_empresa) %>%
mutate(n = 1:n()) %>%
filter(n==1 & !tipo_org %in% c("Asociacion de funcionarios", "ASOCIACION DE FUNCIONARIOS")) %>%
ungroup() %>%
group_by(CAENES_1d, ano) %>%
filter(afil_tot < quantile(afil_tot, .99, na.rm=T)) %>%
summarise(n_sind = n(),
n_afil_tot = sum(afil_tot, na.rm = T),
n_afil_mas = sum(afil_mas, na.rm = T),
n_afil_fem = sum(afil_fem, na.rm = T),
mean_afil_tot = mean(afil_tot, na.rm = T),
mean_afil_mas = mean(afil_mas, na.rm = T),
mean_afil_fem = mean(afil_fem, na.rm = T),
por_dir_fem = round(sum(n_dir_mas<n_dir_tot, na.rm = T)/n()*100,3),
por_fed = round(sum(!is.na(rsu_fed))/n()*100, 3),
por_conf = round(sum(!is.na(rsu_conf))/n()*100, 3),
por_cen = round(sum(!is.na(rsu_cen))/n()*100, 3)) %>%
ungroup() %>%
mutate(CAENES_1d = factor(CAENES_1d)) %>%
filter(!is.na(CAENES_1d))
data = list(nc, nc_contrato, nc_otro, h_nt, h_dur, sind) %>%
reduce(full_join, by = c("CAENES_1d", "ano"))
saveRDS(data, "output/data/data_dt_proc_final.rds")
rm(list=ls())
# Unificar data ENE - DT (OOSS-NC-H) --------------------------------------
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse, sjmisc, writexl)
# Cargar data -------------------------------------------------------------
dt = readRDS("output/data/data_dt_proc_final.rds")
ene = readRDS("output/data/ene_final_CAENES_1d.rds") %>%
mutate(CAENES_1d = factor(CAENES_1d),
ano = as.numeric(ano)) %>%
filter(!is.na(CAENES_1d) & CAENES_1d != "Total")
olas = data.frame(CAENES_1d = factor(rep(levels(ene$CAENES_1d)[1:14], 14)),
ano = map(2010:2023, ~rep(.x, 14)) %>% unlist())
# Unificar ----------------------------------------------------------------
data = list(ene, dt) %>%
reduce(full_join, by = c("CAENES_1d", "ano")) %>%
merge(olas,
.,
by = c("ano", "CAENES_1d"), all = T) %>%
arrange(ano, CAENES_1d) %>%
filter(ano %in% 2010:2023 & CAENES_1d != "34") %>%
mutate(across(total:por_cen,
~tidyr::replace_na(., 0)),
tasa_afiliacion = ifelse(if_all(c(n_afil_tot, total), ~.!=0), round((n_afil_tot/total)*100,3), 0),
por_cobertura = ifelse(if_all(c(cubiertos_tot, total), ~.!=0), round((cubiertos_tot/total)*100,3), 0),
por_cobertura_cont = ifelse(if_all(c(cubiertos_cont, total), ~.!=0), round((cubiertos_cont/total)*100,3), 0),
por_cobertura_otro = ifelse(if_all(c(cubiertos_otro, total), ~.!=0), round((cubiertos_otro/total)*100,3), 0),
n_sind_mil = ifelse(if_all(c(n_sind, total), ~.!=0), round((n_sind/(total/1000))*100,3), 0)) %>%
arrange(CAENES_1d, ano) %>%
#group_by(CAENES_1d, ano) %>%
mutate(across(c(tasa_afiliacion, por_cobertura, por_cobertura_cont, por_cobertura_otro),
~ifelse(ano %in% 2011:2023, dplyr::lag(.), 0),
.names = "lag_{.col}")) %>%
ungroup()
# Exportar ----------------------------------------------------------------
saveRDS(data,"output/data/data_dt_ene_final.rds")
# Explorar bugs -----------------------------------------------------------
#% mayores a 100
data %>%
summarise(across(c(tasa_afiliacion, por_cobertura, por_cobertura_cont),
~sum(. > 100)))
data %>%
filter(if_any(c(tasa_afiliacion, por_cobertura, por_cobertura_cont),
~.>100)) %>%
select(CAENES_1d, ano,
total, n_afil_tot, tasa_afiliacion,
cubiertos_tot, por_cobertura,
cubiertos_cont, por_cobertura_cont,
n_sind) %>%
write_xlsx("rev_porcentajes.xlsx")
ids=data %>%
filter(if_any(c(tasa_afiliacion, por_cobertura, por_cobertura_cont),
~.>100)) %>%
select(CAENES_1d) %>% unique() %>% pull()
j=data %>%
filter(CAENES_1d %in% ids) %>%
select(CAENES_1d, ano,
total, n_afil_tot, tasa_afiliacion,
cubiertos_tot, por_cobertura,
cubiertos_cont, por_cobertura_cont,
n_sind)
rm(list=ls())
# Gráficos de dispersión ENE-OHL-AnuarioDT --------------------------------
# Cargar paquetes ---------------------------------------------------------
pacman::p_load(tidyverse, RColorBrewer, patchwork, ggplot2, ggpubr)
# Cargar data -------------------------------------------------------------
data = readRDS("output/data/data_dt_ene_final.rds") %>%
mutate(t = ifelse(ano %in% 2010:2015, "2010-2015", "2016-2019")) %>%
group_by(t, CAENES_1d) %>%
summarise(across(c(tasa_afiliacion, n_huelgas, n_sind_mil, por_cobertura_cont),
~mean(.))) %>%
ungroup()
# Gráficos ----------------------------------------------------------------
# Afiliación sindical x Número de huelgas ---------------------------------
# data %>%
#   filter(t == "2011-2015") %>%
#   ggplot(aes(x = tasa_afiliacion, y = n_huelgas, label = CAENES_1d)) +
#   geom_point() +
#   geom_smooth(method="lm", se = F)+
#   labs(title = "Relación entre afiliación sindical y número de huelgas",
#        subtitle = "2011-2015",
#        x = "Tasa de afiliación sindical",
#        y = "Número de huelgas",
#        color = "Act. económica") +
#   geom_text(vjust = 1.5) +
#   stat_cor(method="pearson",
#            label.x.npc = 0.78, label.y.npc = 0.95) +
#   theme_bw() +
#   theme(legend.position="bottom")
# ggsave("output/img/graficos_ene_dtrraa/densidad_nhuelgas_1115.png", last_plot(),
#        width = 10, height = 8)
data %>%
filter(t == "2016-2019") %>%
ggplot(aes(x = tasa_afiliacion, y = n_huelgas, label = CAENES_1d)) +
geom_point() +
geom_smooth(method="lm", se = F)+
labs(title = "Relación entre afiliación sindical y número de huelgas",
subtitle = "2016-2019",
x = "Tasa de afiliación sindical",
y = "Número de huelgas",
color = "Act. económica") +
geom_text(vjust = 1.5) +
stat_cor(method="pearson",
label.x.npc = 0.78, label.y.npc = 0.95) +
theme_bw() +
theme(legend.position="bottom")
ggsave("output/img/graficos_ene_dtrraa/densidad_nhuelgas_1619.png", last_plot(),
width = 10, height = 8)
# data %>%
#   ggplot(aes(x = tasa_afiliacion, y = n_huelgas, label = CAENES_1d)) +
#   geom_point(aes(color = t)) +
#   geom_smooth(method="lm", se = F)+
#   labs(title = "Relación entre afiliación sindical y número de huelgas",
#        subtitle = "2011-2019",
#        x = "Tasa de afiliación sindical",
#        y = "Número de huelgas",
#        color = "Act. económica") +
#   geom_text(vjust = 1.5) +
#   stat_cor(method="pearson",
#            label.x.npc = 0.78, label.y.npc = 0.95) +
#   theme_bw() +
#   theme(legend.position="bottom")
#
# ggsave("output/img/graficos_ene_dtrraa/densidad_nhuelgas_1119.png", last_plot(),
#        width = 10, height = 8)
# N sindicatos x N de huelgas ---------------------------------------------
# data %>%
#   filter(t == "2011-2015") %>%
#   ggplot(aes(x = n_sind_mil, y = n_huelgas, label = CAENES_1d)) +
#   geom_point() +
#   geom_smooth(method="lm", se = F)+
#   labs(title = "Relación entre fragmentación sindical y número de huelgas",
#        subtitle = "2011-2015",
#        x = "N. de sindicatos c/mil trabajadores",
#        y = "Número de huelgas",
#        color = "Act. económica") +
#   geom_text(vjust = 1.5) +
#   stat_cor(method="pearson",
#            label.x.npc = 0.78, label.y.npc = 0.90) +
#   theme_bw() +
#   theme(legend.position="bottom")
#
# ggsave("output/img/graficos_ene_dtrraa/fragmentacion_nhuelgas_1115.png", last_plot(),
#        width = 10, height = 8)
data %>%
filter(t == "2016-2019") %>%
ggplot(aes(x = n_sind_mil, y = n_huelgas, label = CAENES_1d)) +
geom_point() +
geom_smooth(method="lm", se = F)+
labs(title = "Relación entre fragmentación sindical y número de huelgas",
subtitle = "2016-2019",
x = "N. de sindicatos c/mil trabajadores",
y = "Número de huelgas",
color = "Act. económica") +
geom_text(vjust = 1.5) +
stat_cor(method="pearson",
label.x.npc = 0.78, label.y.npc = 0.95) +
theme_bw() +
theme(legend.position="bottom")
ggsave("output/img/graficos_ene_dtrraa/fragmentacion_nhuelgas_1519.png", last_plot(),
width = 10, height = 8)
# data %>%
#   ggplot(aes(x = n_sind_mil, y = n_huelgas, label = CAENES_1d)) +
#   geom_point(aes(color = t)) +
#   geom_smooth(method="lm", se = F)+
#   labs(title = "Relación entre fragmentación sindical y número de huelgas",
#        subtitle = "2011-2019",
#        x = "N. de sindicatos c/mil trabajadores",
#        y = "Número de huelgas",
#        color = "Act. económica") +
#   geom_text(vjust = 1.5) +
#   stat_cor(method="pearson",
#            label.x.npc = 0.78, label.y.npc = 0.87) +
#   theme_bw() +
#   theme(legend.position="bottom")
#
# ggsave("output/img/graficos_ene_dtrraa/fragmentacion_nhuelgas_1119.png", last_plot(),
#        width = 10, height = 8)
# Cobertura neg. colectiva x N huelgas ------------------------------------
# data %>%
#   filter(t == "2011-2015") %>%
#   ggplot(aes(x = por_cobertura_cont, y = n_huelgas, label = CAENES_1d)) +
#   geom_point() +
#   geom_smooth(method="lm", se = F)+
#   labs(title = "Relación entre tasa de cobertura de contratos colectivos y número de huelgas",
#        subtitle = "2011-2015",
#        x = "N. de sindicatos c/mil trabajadores",
#        y = "Número de huelgas",
#        color = "Act. económica") +
#   geom_text(vjust = 1.5) +
#   stat_cor(method="pearson",
#            label.x.npc = 0.78, label.y.npc = 0.90) +
#   theme_bw() +
#   theme(legend.position="bottom")
#
# ggsave("output/img/graficos_ene_dtrraa/cobertura_nhuelgas_1115.png", last_plot(),
#        width = 10, height = 8)
data %>%
filter(t == "2016-2019") %>%
ggplot(aes(x = por_cobertura_cont, y = n_huelgas, label = CAENES_1d)) +
geom_point() +
geom_smooth(method="lm", se = F)+
labs(title = "Relación entre tasa de cobertura de contratos colectivos y número de huelgas",
subtitle = "2016-2019",
x = "Tasa de cobertura de negociación colectiva",
y = "Número de huelgas",
color = "Act. económica") +
geom_text(vjust = 1.5) +
stat_cor(method="pearson",
label.x.npc = 0.78, label.y.npc = 0.95) +
theme_bw() +
theme(legend.position="bottom")
ggsave("output/img/graficos_ene_dtrraa/cobertura_nhuelgas_1519.png", last_plot(),
width = 10, height = 8)
# data %>%
#   ggplot(aes(x = por_cobertura_cont, y = n_huelgas, label = CAENES_1d)) +
#   geom_point(aes(color = t)) +
#   geom_smooth(method="lm", se = F)+
#   labs(title = "Relación entre tasa de cobertura de contratos colectivos y número de huelgas",
#        subtitle = "2011-2019",
#        x = "N. de sindicatos c/mil trabajadores",
#        y = "Número de huelgas",
#        color = "Act. económica") +
#   geom_text(vjust = 1.5) +
#   stat_cor(method="pearson",
#            label.x.npc = 0.78, label.y.npc = 0.87) +
#   theme_bw() +
#   theme(legend.position="bottom")
#
# ggsave("output/img/graficos_ene_dtrraa/cobertura_nhuelgas_1119.png", last_plot(),
#        width = 10, height = 8)
data = readRDS("output/data/data_dt_ene_final.rds")
