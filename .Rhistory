mutate(contract_duration = round(contract_duration, 3)*100)
# company_size ------------------------------------------------------------
a = imap(enc,
~.x %>%
group_by(rama, salaried_selfempl, company_size) %>%
summarise(per = survey_prop(na.rm=T)) %>%
mutate(ano = .y))
a = readRDS("output/data/casen_contract_duration.rds")
contract_duration = bind_rows(a) %>%
ungroup() %>%
filter(if_all(c(salaried_selfempl, contract_duration), ~.== "1")) %>%
select(ano, rama, contract_duration=per) %>%
na.omit() %>%
mutate(contract_duration = round(contract_duration, 3)*100)
# company_size ------------------------------------------------------------
# a = imap(enc,
#          ~.x %>%
#            group_by(rama, salaried_selfempl, company_size) %>%
#            summarise(per = survey_prop(na.rm=T)) %>%
#            mutate(ano = .y))
#
# saveRDS(a, "output/data/casen_company_size.rds")
a = readRDS("output/data/casen_company_size.rds")
company_size = bind_rows(a) %>%
ungroup() %>%
filter(if_all(c(salaried_selfempl, company_size), ~.== "1")) %>%
select(ano, rama, company_size=per) %>%
na.omit() %>%
mutate(company_size = round(company_size, 3)*100)
# job_seniority -----------------------------------------------------------
# a = imap(enc[c(4,5)],
#          ~.x %>%
#            group_by(rama, salaried_selfempl) %>%
#            summarise(mean = survey_mean(job_seniority, na.rm=T)) %>%
#            mutate(ano = .y))
#saveRDS(a, "output/data/casen_job_seniority.rds")
a = readRDS("output/data/casen_job_seniority.rds")
a = imap(enc[c(4,5)],
~.x %>%
group_by(rama, salaried_selfempl) %>%
summarise(mean = survey_mean(job_seniority, na.rm=T)) %>%
mutate(ano = .y))
saveRDS(a, "output/data/casen_job_seniority.rds")
a = readRDS("output/data/casen_contract_duration.rds")
contract_duration = bind_rows(a) %>%
ungroup() %>%
filter(if_all(c(salaried_selfempl, contract_duration), ~.== "1")) %>%
select(ano, rama, contract_duration=per) %>%
na.omit() %>%
mutate(contract_duration = round(contract_duration, 3)*100)
# company_size ------------------------------------------------------------
# a = imap(enc,
#          ~.x %>%
#            group_by(rama, salaried_selfempl, company_size) %>%
#            summarise(per = survey_prop(na.rm=T)) %>%
#            mutate(ano = .y))
#
# saveRDS(a, "output/data/casen_company_size.rds")
a = readRDS("output/data/casen_company_size.rds")
company_size = bind_rows(a) %>%
ungroup() %>%
filter(if_all(c(salaried_selfempl, company_size), ~.== "1")) %>%
select(ano, rama, company_size=per) %>%
na.omit() %>%
mutate(company_size = round(company_size, 3)*100)
# job_seniority -----------------------------------------------------------
# a = imap(enc[c(4,5)],
#          ~.x %>%
#            group_by(rama, salaried_selfempl) %>%
#            summarise(mean = survey_mean(job_seniority, na.rm=T)) %>%
#            mutate(ano = .y))
#
# saveRDS(a, "output/data/casen_job_seniority.rds")
a = readRDS("output/data/casen_job_seniority.rds")
job_seniority = bind_rows(a) %>%
ungroup() %>%
filter(salaried_selfempl == "1") %>%
select(ano, rama, job_seniority=mean) %>% na.omit
data = merge(contract_duration, company_size,
by = c("ano", "rama"), all = T)
View(data)
pacman::p_load(tidyverse,
survey,
srvyr,
writexl)
data = merge(contract_duration, company_size,
by = c("ano", "rama"), all = T) %>%
merge(., job_seniority,
by = c("ano", "rama"), all = T)
View(data)
write_xlsx(data, "output/data/casen_98_09.xlsx")
# Preparación de datos ----------------------------------------------------
# Cargar datos ------------------------------------------------------------
ohl <- read.csv2("input/data/OHL1979_2020.csv", na.strings = "")
# Selección y filtrado ----------------------------------------------------
ohl_p <- ohl %>%
filter(yr %in% c(1998:2019) & inst %in% c(1,2)) %>%
select(sector2 = ciuur2,
sector3 = ciuur3,
sector4 = ciuur4,
ano = yr,
duracion,
ddpp,
rangoemp,
#org,
tc,
#reg1,
leg,
dptp = dhtp) %>%
# Recodificación ----------------------------------------------------------
mutate(actividad_raw = case_when(sector2 == 1 | sector3 %in% c(1,2) | sector4 == 0 ~ "1. Agricultura, ganadería, silvicultura y pesca",
sector2 == 2 | sector3 == 3 | sector4 == 1 ~ "2. Minería",
sector2 == 3 | sector3 == 4 | sector4 == 2 ~ "3. Industrias manufactureras",
sector2 == 4 | sector3 == 5 | sector4 %in% c(3,4) ~ "4. Suministro de electricidad, gas y agua",
sector2 == 5 | sector3 == 6 | sector4 == 5 ~ "5. Construcción",
sector2 == 6 | sector3 %in% c(7,8) | sector4 %in% c(6,8) ~ "6. Comercio, hoteles y restaurantes",
sector2 == 7 | sector3 == 9 | sector4 %in% c(7,9) ~ "7. Transporte y comunicaciones",
sector2 == 8 | sector3 %in% c(10,11) | sector4 %in% c(10:13) ~ "8. Servicios financieros, inmobiliarios y empresariales",
sector2 %in% c(9:12) | sector3 %in% c(12:17) | sector4 %in% c(14:20) ~ "9. Servicios sociales, domésticos, profesionales y otros",
TRUE ~ NA_character_) %>%
factor(),
dptp = as.numeric(gsub(",", ".", .$dptp)),
leg = ifelse(leg == 1, 1, 0),
extra_leg = ifelse(leg == 0, 1, 0)) %>%
rowwise() %>%
mutate(
n_huelga = sum(leg, extra_leg, na.rm = T)
) %>%
ungroup() %>%
select(ano,
actividad_raw,
duracion,
ddpp,
rangoemp,
tc,
n_huelga,
leg,
extra_leg,
dptp)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
View(a)
a=a %>%
select(ano, actividad_raw, duracion)
View(a)
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit
View(a)
190/9
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
group_by(ano, actividad_raw) %>%
mutate(lag_duracion = lag(duracion)) %>%
ungroup
View(a)
?lag
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(ano, actividad_raw) %>%
mutate(lag_duracion = lag(duracion)) %>%
ungroup
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = lag(duracion)) %>%
ungroup() %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = lag(duracion)) %>%
ungroup()
View(a)
# Selección y filtrado ----------------------------------------------------
ohl_p <- ohl %>%
filter(yr %in% c(1998:2019) & inst %in% c(1,2)) %>%
select(sector2 = ciuur2,
sector3 = ciuur3,
sector4 = ciuur4,
ano = yr,
duracion,
ddpp,
rangoemp,
#org,
tc,
#reg1,
leg,
dptp = dhtp) %>%
# Recodificación ----------------------------------------------------------
mutate(actividad_raw = case_when(sector2 == 1 | sector3 %in% c(1,2) | sector4 == 0 ~ "1. Agricultura, ganadería, silvicultura y pesca",
sector2 == 2 | sector3 == 3 | sector4 == 1 ~ "2. Minería",
sector2 == 3 | sector3 == 4 | sector4 == 2 ~ "3. Industrias manufactureras",
sector2 == 4 | sector3 == 5 | sector4 %in% c(3,4) ~ "4. Suministro de electricidad, gas y agua",
sector2 == 5 | sector3 == 6 | sector4 == 5 ~ "5. Construcción",
sector2 == 6 | sector3 %in% c(7,8) | sector4 %in% c(6,8) ~ "6. Comercio, hoteles y restaurantes",
sector2 == 7 | sector3 == 9 | sector4 %in% c(7,9) ~ "7. Transporte y comunicaciones",
sector2 == 8 | sector3 %in% c(10,11) | sector4 %in% c(10:13) ~ "8. Servicios financieros, inmobiliarios y empresariales",
sector2 %in% c(9:12) | sector3 %in% c(12:17) | sector4 %in% c(14:20) ~ "9. Servicios sociales, domésticos, profesionales y otros",
TRUE ~ NA_character_) %>%
factor(),
dptp = as.numeric(gsub(",", ".", .$dptp)),
leg = ifelse(leg == 1, 1, 0),
extra_leg = ifelse(leg == 0, 1, 0)) %>%
rowwise() %>%
mutate(
n_huelga = sum(leg, extra_leg, na.rm = T)
) %>%
ungroup() %>%
select(ano,
actividad_raw,
duracion,
ddpp,
rangoemp,
tc,
n_huelga,
leg,
extra_leg,
dptp)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = lag(duracion)) %>%
arrange(ano, actividad_raw)
View(a)
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = lag(duracion))
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = lag(duracion))
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion)) %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion)) %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(ano,actividad_raw) %>%
mutate(lag_duracion = dplyr::lag(duracion))
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion))
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
#group_by(ano, actividad_raw) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion)) %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a=a %>%
select(ano, actividad_raw, duracion) %>% na.omit %>%
group_by(actividad_raw, ano) %>%
arrange(actividad_raw, ano) %>%
mutate(lag_duracion = dplyr::lag(duracion)) %>%
ungroup() %>%
arrange(ano, actividad_raw)
View(a)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a %>%
select(ano, actividad_raw, duracion) %>%
na.omit %>%
write_xlsx("output/data/duracion_huelgas.xlsx")
directorio = "C:/Users/nicol/Downloads"
setwd(directorio)
archivos = list.files()
?list.files
archivos = list.files(pattern = "2023-10-13_XV. Arica y Parinacota_*.rds")
archivos = list.files(pattern = "2023-10-13_XV. Arica y Parinacota")
archivos
a = map(archivos, ~readRDS(.x))
library(tidyverse)
a = map(archivos, ~readRDS(.x))
a[[1]]
a[[2]]
a[[3]]
a[[4]]
a[[5]]
library(ggplotly)
library(plotly)
install.packages("plotly")
library(plotly)
a[[3]]
a[[4]]
a[[5]]
a[[6]]
a[[7]]
a[[5]]
print(a[[5]])
a[[10]]
a[[9]]
a[[8]]
a[[7]]
View(a)
a[[5]]
a[[4]]
a[[5]]
library(ggplot2)
library(plotly)
a[[5]]
print(readRDS(archivos[[5]]))
print(readRDS(archivos[[6]]))
print(readRDS(archivos[[5]]))
class(readRDS(archivos[[5]]))
View(a)
print(a[[5]])
archivos[[5]])
archivos[[5]]
archivos[[6]]
archivos[[7]]
archivos[[8]]
print(readRDS(archivos[[5]])) #Autoaplicado
print(readRDS(archivos[[6]])) #Emp
print(readRDS(archivos[[7]])) #ST
print(readRDS(archivos[[6]])) #Emp
print(readRDS(archivos[[7]])) #ST
ohl <- read.csv2("input/data/OHL1979_2020.csv", na.strings = "")
# Selección y filtrado ----------------------------------------------------
ohl_p <- ohl %>%
filter(yr %in% c(1998:2019) & inst %in% c(1,2)) %>%
select(sector2 = ciuur2,
sector3 = ciuur3,
sector4 = ciuur4,
ano = yr,
duracion,
ddpp,
rangoemp,
#org,
tc,
#reg1,
leg,
dptp = dhtp) %>%
# Recodificación ----------------------------------------------------------
mutate(actividad_raw = case_when(sector2 == 1 | sector3 %in% c(1,2) | sector4 == 0 ~ "1. Agricultura, ganadería, silvicultura y pesca",
sector2 == 2 | sector3 == 3 | sector4 == 1 ~ "2. Minería",
sector2 == 3 | sector3 == 4 | sector4 == 2 ~ "3. Industrias manufactureras",
sector2 == 4 | sector3 == 5 | sector4 %in% c(3,4) ~ "4. Suministro de electricidad, gas y agua",
sector2 == 5 | sector3 == 6 | sector4 == 5 ~ "5. Construcción",
sector2 == 6 | sector3 %in% c(7,8) | sector4 %in% c(6,8) ~ "6. Comercio, hoteles y restaurantes",
sector2 == 7 | sector3 == 9 | sector4 %in% c(7,9) ~ "7. Transporte y comunicaciones",
sector2 == 8 | sector3 %in% c(10,11) | sector4 %in% c(10:13) ~ "8. Servicios financieros, inmobiliarios y empresariales",
sector2 %in% c(9:12) | sector3 %in% c(12:17) | sector4 %in% c(14:20) ~ "9. Servicios sociales, domésticos, profesionales y otros",
TRUE ~ NA_character_) %>%
factor(),
dptp = as.numeric(gsub(",", ".", .$dptp)),
leg = ifelse(leg == 1, 1, 0),
extra_leg = ifelse(leg == 0, 1, 0)) %>%
rowwise() %>%
mutate(
n_huelga = sum(leg, extra_leg, na.rm = T)
) %>%
ungroup() %>%
select(ano,
actividad_raw,
duracion,
ddpp,
rangoemp,
tc,
n_huelga,
leg,
extra_leg,
dptp)
pacman::p_load(tidyverse, readxl,sjmisc)
ohl <- read.csv2("input/data/OHL1979_2020.csv", na.strings = "")
# Selección y filtrado ----------------------------------------------------
ohl_p <- ohl %>%
filter(yr %in% c(1998:2019) & inst %in% c(1,2)) %>%
select(sector2 = ciuur2,
sector3 = ciuur3,
sector4 = ciuur4,
ano = yr,
duracion,
ddpp,
rangoemp,
#org,
tc,
#reg1,
leg,
dptp = dhtp) %>%
# Recodificación ----------------------------------------------------------
mutate(actividad_raw = case_when(sector2 == 1 | sector3 %in% c(1,2) | sector4 == 0 ~ "1. Agricultura, ganadería, silvicultura y pesca",
sector2 == 2 | sector3 == 3 | sector4 == 1 ~ "2. Minería",
sector2 == 3 | sector3 == 4 | sector4 == 2 ~ "3. Industrias manufactureras",
sector2 == 4 | sector3 == 5 | sector4 %in% c(3,4) ~ "4. Suministro de electricidad, gas y agua",
sector2 == 5 | sector3 == 6 | sector4 == 5 ~ "5. Construcción",
sector2 == 6 | sector3 %in% c(7,8) | sector4 %in% c(6,8) ~ "6. Comercio, hoteles y restaurantes",
sector2 == 7 | sector3 == 9 | sector4 %in% c(7,9) ~ "7. Transporte y comunicaciones",
sector2 == 8 | sector3 %in% c(10,11) | sector4 %in% c(10:13) ~ "8. Servicios financieros, inmobiliarios y empresariales",
sector2 %in% c(9:12) | sector3 %in% c(12:17) | sector4 %in% c(14:20) ~ "9. Servicios sociales, domésticos, profesionales y otros",
TRUE ~ NA_character_) %>%
factor(),
dptp = as.numeric(gsub(",", ".", .$dptp)),
leg = ifelse(leg == 1, 1, 0),
extra_leg = ifelse(leg == 0, 1, 0)) %>%
rowwise() %>%
mutate(
n_huelga = sum(leg, extra_leg, na.rm = T)
) %>%
ungroup() %>%
select(ano,
actividad_raw,
duracion,
ddpp,
rangoemp,
tc,
n_huelga,
leg,
extra_leg,
dptp)
a=ohl_p %>%
group_by(ano, actividad_raw) %>%
summarise(across(c(dptp, tc, duracion),
~mean(., na.rm=T)),
n_huelga = sum(n_huelga, na.rm=T))
a %>% filter(str_detect(actividad_raw, "4."))
a %>% filter(str_detect(actividad_raw, "1."))
a %>% filter(str_detect(actividad_raw, "1."))
head(a %>% filter(str_detect(actividad_raw, "1.")), 21)
b=a %>% filter(str_detect(actividad_raw, "1."))
View(b)
b=a %>% filter(str_detect(actividad_raw, "4."))
b=a %>% filter(str_detect(actividad_raw, "5."))
